PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE ChannelRanges (
                                    ID INTEGER PRIMARY KEY AUTOINCREMENT,
                                    MainTableID INT,
                                    StartRange INT,
                                    EndRange INT, Notes TEXT,
                                    FOREIGN KEY (MainTableID) REFERENCES UniqueNames(ID)
);
INSERT INTO ChannelRanges VALUES(4,1,5,85,NULL);
INSERT INTO ChannelRanges VALUES(5,1,337,359,'60 day trial');
INSERT INTO ChannelRanges VALUES(6,3,119,119,NULL);
INSERT INTO ChannelRanges VALUES(7,2,400,699,NULL);
INSERT INTO ChannelRanges VALUES(8,6,119,119,NULL);
INSERT INTO ChannelRanges VALUES(9,9,119,119,NULL);
INSERT INTO ChannelRanges VALUES(10,12,119,119,NULL);
INSERT INTO ChannelRanges VALUES(11,4,755,779,NULL);
INSERT INTO ChannelRanges VALUES(12,4,5,85,NULL);
INSERT INTO ChannelRanges VALUES(13,4,337,359,'60 day trial');
INSERT INTO ChannelRanges VALUES(14,5,120,169,NULL);
INSERT INTO ChannelRanges VALUES(15,5,400,699,NULL);
INSERT INTO ChannelRanges VALUES(16,5,700,754,NULL);
INSERT INTO ChannelRanges VALUES(17,8,120,169,NULL);
INSERT INTO ChannelRanges VALUES(18,8,400,665,NULL);
INSERT INTO ChannelRanges VALUES(19,8,667,699,NULL);
INSERT INTO ChannelRanges VALUES(20,8,700,754,NULL);
INSERT INTO ChannelRanges VALUES(21,7,5,85,NULL);
INSERT INTO ChannelRanges VALUES(22,7,337,359,'60 day trial');
INSERT INTO ChannelRanges VALUES(23,7,755,779,NULL);
INSERT INTO ChannelRanges VALUES(24,11,120,169,NULL);
INSERT INTO ChannelRanges VALUES(25,11,400,665,NULL);
INSERT INTO ChannelRanges VALUES(26,11,667,699,NULL);
INSERT INTO ChannelRanges VALUES(27,11,700,754,NULL);
INSERT INTO ChannelRanges VALUES(28,11,85,85,NULL);
INSERT INTO ChannelRanges VALUES(29,11,86,95,NULL);
INSERT INTO ChannelRanges VALUES(30,11,96,105,NULL);
INSERT INTO ChannelRanges VALUES(31,11,170,186,NULL);
INSERT INTO ChannelRanges VALUES(32,11,189,189,NULL);
INSERT INTO ChannelRanges VALUES(33,11,190,190,NULL);
INSERT INTO ChannelRanges VALUES(34,11,191,191,NULL);
INSERT INTO ChannelRanges VALUES(35,11,107,118,NULL);
INSERT INTO ChannelRanges VALUES(36,11,192,336,NULL);
INSERT INTO ChannelRanges VALUES(37,11,755,899,NULL);
INSERT INTO ChannelRanges VALUES(38,11,921,979,NULL);
INSERT INTO ChannelRanges VALUES(39,10,5,85,NULL);
INSERT INTO ChannelRanges VALUES(40,10,337,359,'60 day trial');
INSERT INTO ChannelRanges VALUES(41,10,755,779,NULL);
INSERT INTO ChannelRanges VALUES(42,10,106,106,NULL);
INSERT INTO ChannelRanges VALUES(43,10,187,187,'60 day trial');
INSERT INTO ChannelRanges VALUES(44,10,188,188,'60 day trial');
INSERT INTO ChannelRanges VALUES(45,10,362,376,NULL);
INSERT INTO ChannelRanges VALUES(46,10,377,377,NULL);
INSERT INTO ChannelRanges VALUES(47,10,984,984,NULL);
INSERT INTO ChannelRanges VALUES(48,13,5,85,NULL);
INSERT INTO ChannelRanges VALUES(49,13,337,359,'60 day trial');
INSERT INTO ChannelRanges VALUES(50,13,755,779,NULL);
INSERT INTO ChannelRanges VALUES(51,13,785,789,NULL);
INSERT INTO ChannelRanges VALUES(52,14,120,169,NULL);
INSERT INTO ChannelRanges VALUES(53,14,400,699,NULL);
INSERT INTO ChannelRanges VALUES(54,14,170,269,NULL);
INSERT INTO ChannelRanges VALUES(55,15,119,119,NULL);
INSERT INTO ChannelRanges VALUES(56,16,640,699,NULL);
INSERT INTO ChannelRanges VALUES(57,17,5,85,NULL);
INSERT INTO ChannelRanges VALUES(58,17,337,359,'60 day trial');
INSERT INTO ChannelRanges VALUES(59,17,755,779,NULL);
INSERT INTO ChannelRanges VALUES(60,17,785,789,NULL);
INSERT INTO ChannelRanges VALUES(61,17,360,369,'60 day trial');
INSERT INTO ChannelRanges VALUES(62,17,803,899,NULL);
INSERT INTO ChannelRanges VALUES(63,18,120,169,NULL);
INSERT INTO ChannelRanges VALUES(64,18,400,699,NULL);
INSERT INTO ChannelRanges VALUES(65,18,170,269,NULL);
INSERT INTO ChannelRanges VALUES(66,18,700,754,NULL);
INSERT INTO ChannelRanges VALUES(67,19,119,119,NULL);
INSERT INTO ChannelRanges VALUES(68,20,640,699,NULL);
INSERT INTO ChannelRanges VALUES(69,21,5,85,NULL);
INSERT INTO ChannelRanges VALUES(70,21,337,359,'60 day trial');
INSERT INTO ChannelRanges VALUES(71,21,755,779,NULL);
INSERT INTO ChannelRanges VALUES(72,21,785,789,NULL);
INSERT INTO ChannelRanges VALUES(73,21,360,369,'60 day trial');
INSERT INTO ChannelRanges VALUES(74,21,85,89,NULL);
INSERT INTO ChannelRanges VALUES(75,21,95,99,NULL);
INSERT INTO ChannelRanges VALUES(76,22,120,169,NULL);
INSERT INTO ChannelRanges VALUES(77,22,400,665,NULL);
INSERT INTO ChannelRanges VALUES(78,22,667,699,NULL);
INSERT INTO ChannelRanges VALUES(79,22,170,269,NULL);
INSERT INTO ChannelRanges VALUES(80,22,700,754,NULL);
INSERT INTO ChannelRanges VALUES(81,22,803,899,NULL);
INSERT INTO ChannelRanges VALUES(82,23,119,119,NULL);
INSERT INTO ChannelRanges VALUES(83,24,640,699,NULL);
INSERT INTO ChannelRanges VALUES(84,25,5,85,NULL);
INSERT INTO ChannelRanges VALUES(85,25,337,359,'60 day trial');
INSERT INTO ChannelRanges VALUES(86,25,755,779,NULL);
INSERT INTO ChannelRanges VALUES(87,25,785,789,NULL);
INSERT INTO ChannelRanges VALUES(88,25,360,369,'60 day trial');
INSERT INTO ChannelRanges VALUES(89,25,85,89,NULL);
INSERT INTO ChannelRanges VALUES(90,25,95,99,NULL);
INSERT INTO ChannelRanges VALUES(91,25,90,90,NULL);
INSERT INTO ChannelRanges VALUES(92,25,111,111,'60 day trial');
INSERT INTO ChannelRanges VALUES(93,25,112,112,'60 day trial');
INSERT INTO ChannelRanges VALUES(94,25,114,116,NULL);
INSERT INTO ChannelRanges VALUES(95,25,311,334,NULL);
INSERT INTO ChannelRanges VALUES(96,25,336,336,NULL);
INSERT INTO ChannelRanges VALUES(97,25,370,384,NULL);
INSERT INTO ChannelRanges VALUES(98,25,385,385,NULL);
INSERT INTO ChannelRanges VALUES(99,26,120,169,NULL);
INSERT INTO ChannelRanges VALUES(100,26,400,665,NULL);
INSERT INTO ChannelRanges VALUES(101,26,667,699,NULL);
INSERT INTO ChannelRanges VALUES(102,26,170,269,NULL);
INSERT INTO ChannelRanges VALUES(103,26,700,754,NULL);
INSERT INTO ChannelRanges VALUES(104,26,803,899,NULL);
INSERT INTO ChannelRanges VALUES(105,26,90,90,NULL);
INSERT INTO ChannelRanges VALUES(106,26,100,110,NULL);
INSERT INTO ChannelRanges VALUES(107,26,113,113,NULL);
INSERT INTO ChannelRanges VALUES(108,26,114,114,NULL);
INSERT INTO ChannelRanges VALUES(109,26,271,336,NULL);
INSERT INTO ChannelRanges VALUES(110,26,370,399,NULL);
INSERT INTO ChannelRanges VALUES(111,26,780,784,NULL);
INSERT INTO ChannelRanges VALUES(112,26,790,799,NULL);
INSERT INTO ChannelRanges VALUES(113,26,900,979,NULL);
INSERT INTO ChannelRanges VALUES(114,27,119,119,NULL);
INSERT INTO ChannelRanges VALUES(115,28,640,699,NULL);
INSERT INTO ChannelRanges VALUES(116,28,700,701,NULL);
INSERT INTO ChannelRanges VALUES(117,28,704,705,NULL);
CREATE TABLE IF NOT EXISTS "BINKs"
(
    ID          INTEGER
        primary key autoincrement,
    MainTableID INT
        references UniqueNames,
    BINK        TEXT
);
INSERT INTO BINKs VALUES(13,1,'2A');
INSERT INTO BINKs VALUES(14,2,'2B');
INSERT INTO BINKs VALUES(15,3,'2B');
INSERT INTO BINKs VALUES(16,4,'2A');
INSERT INTO BINKs VALUES(17,5,'2B');
INSERT INTO BINKs VALUES(18,6,'2B');
INSERT INTO BINKs VALUES(19,7,'2A');
INSERT INTO BINKs VALUES(20,8,'2B');
INSERT INTO BINKs VALUES(21,9,'2B');
INSERT INTO BINKs VALUES(22,10,'2A');
INSERT INTO BINKs VALUES(23,11,'2B');
INSERT INTO BINKs VALUES(24,12,'2B');
INSERT INTO BINKs VALUES(25,13,'2C');
INSERT INTO BINKs VALUES(26,14,'2D');
INSERT INTO BINKs VALUES(27,15,'2D');
INSERT INTO BINKs VALUES(28,16,'2E');
INSERT INTO BINKs VALUES(29,17,'2C');
INSERT INTO BINKs VALUES(30,18,'2D');
INSERT INTO BINKs VALUES(31,19,'2D');
INSERT INTO BINKs VALUES(32,20,'2E');
INSERT INTO BINKs VALUES(33,21,'2C');
INSERT INTO BINKs VALUES(34,22,'2D');
INSERT INTO BINKs VALUES(35,23,'2D');
INSERT INTO BINKs VALUES(36,24,'2E');
INSERT INTO BINKs VALUES(37,25,'2C');
INSERT INTO BINKs VALUES(38,26,'2D');
INSERT INTO BINKs VALUES(39,27,'2D');
INSERT INTO BINKs VALUES(40,28,'2E');
CREATE TABLE IF NOT EXISTS "products"
(
    ID             INTEGER
        primary key autoincrement,
    name           text not null,
    edition        text not null,
    licenseType    text not null,
    serviceRelease text not null,
    variant        text,
    architecture   text not null
);
INSERT INTO products VALUES(1,'Windows XP','Home Edition','Retail','RTM',NULL,'x86');
INSERT INTO products VALUES(2,'Windows XP','Home Edition','OEM-COA','RTM',NULL,'x86');
INSERT INTO products VALUES(3,'Windows XP','Home Edition','OEM-SLP','RTM',NULL,'x86');
INSERT INTO products VALUES(4,'Windows XP','Home Edition','Retail','SP1',NULL,'x86');
INSERT INTO products VALUES(5,'Windows XP','Home Edition','OEM-COA','SP1',NULL,'x86');
INSERT INTO products VALUES(6,'Windows XP','Home Edition','OEM-SLP','SP1',NULL,'x86');
INSERT INTO products VALUES(7,'Windows XP','Home Edition','Retail','SP2',NULL,'x86');
INSERT INTO products VALUES(8,'Windows XP','Home Edition','OEM-COA','SP2',NULL,'x86');
INSERT INTO products VALUES(9,'Windows XP','Home Edition','OEM-SLP','SP2',NULL,'x86');
INSERT INTO products VALUES(10,'Windows XP','Home Edition','Retail','SP3',NULL,'x86');
INSERT INTO products VALUES(11,'Windows XP','Home Edition','OEM-COA','SP3',NULL,'x86');
INSERT INTO products VALUES(12,'Windows XP','Home Edition','OEM-SLP','SP3',NULL,'x86');
INSERT INTO products VALUES(13,'Windows XP','Professional','Retail','RTM',NULL,'x86');
INSERT INTO products VALUES(14,'Windows XP','Professional','OEM-COA','RTM',NULL,'x86');
INSERT INTO products VALUES(15,'Windows XP','Professional','OEM-SLP','RTM',NULL,'x86');
INSERT INTO products VALUES(16,'Windows XP','Professional','Volume','RTM',NULL,'x86');
INSERT INTO products VALUES(17,'Windows XP','Professional','Retail','SP1',NULL,'x86');
INSERT INTO products VALUES(18,'Windows XP','Professional','OEM-COA','SP1',NULL,'x86');
INSERT INTO products VALUES(19,'Windows XP','Professional','OEM-SLP','SP1',NULL,'x86');
INSERT INTO products VALUES(20,'Windows XP','Professional','Volume','SP1',NULL,'x86');
INSERT INTO products VALUES(21,'Windows XP','Professional','Retail','SP2',NULL,'x86');
INSERT INTO products VALUES(22,'Windows XP','Professional','OEM-COA','SP2',NULL,'x86');
INSERT INTO products VALUES(23,'Windows XP','Professional','OEM-SLP','SP2',NULL,'x86');
INSERT INTO products VALUES(24,'Windows XP','Professional','Volume','SP2',NULL,'x86');
INSERT INTO products VALUES(25,'Windows XP','Professional','Retail','SP3',NULL,'x86');
INSERT INTO products VALUES(26,'Windows XP','Professional','OEM-COA','SP3',NULL,'x86');
INSERT INTO products VALUES(27,'Windows XP','Professional','OEM-SLP','SP3',NULL,'x86');
INSERT INTO products VALUES(28,'Windows XP','Professional','Volume','SP3',NULL,'x86');
DELETE FROM sqlite_sequence;
INSERT INTO sqlite_sequence VALUES('BINKs',40);
INSERT INTO sqlite_sequence VALUES('ChannelRanges',117);
INSERT INTO sqlite_sequence VALUES('products',28);
CREATE VIEW FullView as
WITH NotesCTE AS (
    SELECT
        c.MainTableID,
        CONCAT('[', c.StartRange, ',', c.EndRange, ']: ', c.Notes) AS NoteEntry
    FROM
        ChannelRanges c
    WHERE
        c.Notes IS NOT NULL
    GROUP BY
        c.MainTableID, c.StartRange, c.EndRange, c.Notes
)

-- Main query to aggregate data
SELECT
    m.name, m.edition, m.licenseType, m.serviceRelease, m.variant, m.architecture,
    CONCAT('[', GROUP_CONCAT(DISTINCT b.BINK ORDER BY b.BINK), ']') AS BINKs,
    CONCAT(
            '[',
            GROUP_CONCAT(
                    DISTINCT CONCAT('[', c.StartRange, ',', c.EndRange, ']')
                    ORDER BY c.StartRange
            ),
            ']'
    ) AS ChannelRanges,
    GROUP_CONCAT(
            DISTINCT NoteEntry
            ORDER BY NoteEntry
    ) AS Notes
FROM
    products m
        LEFT JOIN
    BINKs b ON m.ID = b.MainTableID
        LEFT JOIN
    ChannelRanges c ON m.ID = c.MainTableID
        LEFT JOIN
    NotesCTE n ON m.ID = n.MainTableID
GROUP BY
    m.ID, m.name
;
COMMIT;
